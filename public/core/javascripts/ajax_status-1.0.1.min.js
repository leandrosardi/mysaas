/*
 * ## AJAX_STATUS.JS
 * ajax_status.js
 * 
 * Little JavaScript module to show the status of an AJAX request in the HTML page.
 * 
 * This library follows the best practices enumarated here:
 * https://www.w3.org/community/webed/wiki/JavaScript_best_practices
 * 
 */

ajaxStatus = {

	/*
	 * Returns the version of this commonsJs library.
	 *  
	 */
	version: function() {
		return '1.0.2';
	},

	/*
	 * Hides the widget.
	 * 
	 */
	hide: function() {
		$('.ajax_status_badge').hide();
	},

	/*
	 * Shows and turns on the blue saving message.
	 * 
	 */
	switchToSaving: function() {
		$('.ajax-status-banner-blue').show();
		$('.ajax-status-banner-green').hide();
		$('.ajax-status-banner-red').hide();		
	},

	/*
	 * Shows and turns on the green success message.
	 * 
	 */
	switchToSuccess: function() {
		$('.ajax-status-banner-blue').hide();
		$('.ajax-status-banner-green').show();
		$('.ajax-status-banner-red').hide();
		setTimeout(function() {
			$('.ajax-status-banner-green').hide('fade');
		}, 1000);
	},

	/*
	 * Shows and turns on the red error message.
	 * 
	 */
	switchToError: function() {
		$('.ajax-status-banner-blue').hide();
		$('.ajax-status-banner-green').hide();
		$('.ajax-status-banner-red').show();
		setTimeout(function() {
			$('.ajax-status-banner-red').hide('fade');
		}, 1000);
	},	
	
	
	setup: function() {
		// when scrolling smoothly to a title, I need the title get positioned in top=120px instead top=0px, since the top bar is stick to the top, and it will hide the title.
		$('.scroll').click(function() {			
			// Detect when scrolling has finished when using 'scroll-behavior: smooth'
			// The only feasible option appears to be to just wait until there aren't any more scroll events
			// More information: https://stackoverflow.com/questions/46827193/detect-when-scrolling-has-finished-when-using-scroll-behavior-smooth
			// More information: https://gomakethings.com/detecting-when-a-visitor-has-stopped-scrolling-with-vanilla-javascript/
			// More information: w3schools.com/jsref/met_element_removeeventlistener.asp
			var timer = null;
			function myFunction() {
			    clearTimeout( timer );
			    timer = setTimeout( function() {
			    	window.removeEventListener( 'scroll', myFunction );
					window.scrollBy(0,-120);
			    }, 100 );				
			}			
			window.addEventListener( 'scroll', myFunction, { passive: false } );
		});
		
		// When the user scrolls the page, execute myFunction
		window.onscroll = function() {myFunction(); };
		
		// When the user scrolls the page, execute myFunction
		window.onresize = function() {myFunction(); };
		
		// Add the mysticky class to the mynavbar when you reach its scroll position. Remove "mysticky" when you leave the scroll position
		function myFunction() {
		
			// Get the mynavbar
			var mynavbar = $('.mynavbar').get(0);
			
			// Get the mynavbar
			var myleftbar = $('.myleftbar').get(0);
			
			// Get the offset position of the mynavbar
			if ( commonsJs.isDefined(mynavbar) == true ) {
				var mysticky = mynavbar.offsetTop;
							
				if (window.pageYOffset >= mysticky) {
					mynavbar.classList.add("mysticky");
				} else {
					mynavbar.classList.remove("mysticky");
				}
			}
			
			// Get the offset position of the mynavbar
			if ( commonsJs.isDefined(myleftbar) == true ) {
				var myleftsticky = myleftbar.offsetTop;
	
				if (window.pageYOffset >= myleftsticky && window.innerWidth >= 860) {
					myleftbar.classList.add("myleftsticky");
				} else {
					myleftbar.classList.remove("myleftsticky");
				}
			}
		}		
	},
};