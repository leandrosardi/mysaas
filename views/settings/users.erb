<%
account = @login.user.account

# variables de sesion para recordar datos de un nuevo usuario a crear
name = session['settings.users.name'].to_s 
email = session['settings.users.email'].to_s
phone = session['settings.users.phone'].to_s
%>

<div class="mynavbar mysticky">
	<section class="row-fluid">	
		<div class='span6'>
			<%=nav2("Settings", "/settings/dashboard", "Users")%>
		</div>
		<div class='span6' align='right' style='text-align: right;alignment-adjust: right; margin-left: 0;'>
			<button id='save' name='save' class="btn btn-blue btn-medium" type="button" title='Save Changes On Selected Users'>
				<i class="icon-ok"></i>
				Save
			</button>
		</div>
	</section>
</div>

<section class="container box">		
	<table class="table table-striped" style='table-layout: fixed; width: 100%;'>
		<thead>
			<th style='text-align: center; width:15px' >
				<input class="checkbox" id="checkAll" type="checkbox">
			</th>
			<th style ='width:36px;'>
				<!-- picture -->
			</th>
			<th style ='width:auto;'>
				Name
			</th>
			<th style ='width:auto;'>
				Email
			</th>
			<th style ='width:auto;'>
				Phone
			</th>
			<th style='width:36px;'>
				Verified
			</th>
		</thead>

		<tbody>
			<%
			account.users.select { |user| user.delete_time.nil? }.each { |user|
			%>
			<tr>
				<td style='text-align: center; vertical-align: middle;'>
					<input class="checkbox select-row" type="checkbox" id="<%=user.id.to_guid%>" data-id="<%=user.id.to_guid%>">
				</td>
				<td>
					<img class='avatar' src="<%="https://www.gravatar.com/avatar/" + Digest::MD5.hexdigest(user.email.strip.downcase)%>" alt="<%=user.name.to_s.encode_html%>">
				</td>
				<td>
					<input class='user-input input-block-level select-all-on-focus' type='text' value='<%=user.name.to_s.encode_html%>'>
				</td>						
				<td>
					<input class='user-input input-block-level select-all-on-focus' type='text' value='<%=user.email.to_s.encode_html%>'>
				</td>						
				<td>
					<input class='user-input input-block-level select-all-on-focus' type='text' value='<%=user.phone.to_s.encode_html%>'>
				</td>
				<td style='text-align: center; vertical-align: middle;'>
					<% if user.verified %>
						<span style='color:green;'><i class="icon-ok"></i></span>
					<% else %>
						<span style='color:gray;'><i class="icon-remove"></i></span>
					<% end %>
				</td>
			</tr>
			<%
			# release resources on each iteration
			GC.start
			DB.disconnect
			}
			%>

			<tr>
				<td colspan=2>
					<span class='badge badge-green'>Add user</span>
				</td>
				<td>
					<input class='user-input input-block-level select-all-on-focus' type='text' value='<%=name.to_s.encode_html%>'>
				</td>						
				<td>
					<input class='user-input input-block-level select-all-on-focus' type='text' value='<%=email.to_s.encode_html%>'>
				</td>						
				<td>
					<input class='user-input input-block-level select-all-on-focus' type='text' value='<%=phone.to_s.encode_html%>'>
				</td>
				<td style='text-align: center; vertical-align: middle;'>
					<button class='btn btn-link'><i class='icon-plus'></i></button>
				</td>
			</tr>

		</tbody>
	</table>
</section>
