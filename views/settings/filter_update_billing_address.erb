<!-- HERE IS HOW TO CATCH POST/GET PARAMETERS -->
<%
login = BlackStack::Login.where(:id=>session['login.id']).first
if (login == nil)
# libero recursos
DB.disconnect
GC.start
  redirect_adapted_to_nginx CS_LOGIN_PAGE
end
user = BlackStack::User.where(:id=>login.id_user).first
c = BlackStack::Client.where(:id=>user.id_client).first
division = c.division

billing_address = params["billing_address"].to_s
billing_city = params["billing_city"].to_s
billing_state = params["billing_state"].to_s
billing_zipcode = params["billing_zipcode"].to_s
billing_id_lncountry = params["billing_id_lncountry"].to_s

session['settings.information.billing_address'] = billing_address.to_s
session['settings.information.billing_city'] = billing_city.to_s
session['settings.information.billing_state'] = billing_state.to_s
session['settings.information.billing_zipcode'] = billing_zipcode.to_s
session['settings.information.billing_id_lncountry'] = billing_id_lncountry.to_s


if (
	billing_address.to_s.size == 0 ||
	billing_city.to_s.size == 0 ||
	billing_state.to_s.size == 0 ||
	billing_zipcode.to_s.size == 0 ||
	billing_id_lncountry.to_s.size == 0
)
	# libero recursos
	DB.disconnect
	GC.start
	
	# redireccionar al dashboard
	redirect_adapted_to_nginx "/settings/clientinformation?errdesc=#{CGI.escape('All fields in the Billing Information are Mandatry.')}"
end
  
# Actualizo la password
DB.execute(
	"UPDATE [client] SET " +
	"	billing_address = '#{billing_address.to_s.to_sql}', " +
	"	billing_city = '#{billing_city.to_s.to_sql}', " +
	"	billing_state = '#{billing_state.to_s.to_sql}', " +
	"	billing_zipcode = '#{billing_zipcode.to_s.to_sql}', " +
	"	billing_id_lncountry = '#{billing_id_lncountry.to_s.to_sql}' WHERE [id]='#{c.id}'"
)

# libero recursos
DB.disconnect
GC.start

# redireccionar al dashboard o a la pantalla que se haya pedido
redirect_after_update = session['redirect_after_clientinformation_update']
if redirect_after_update.to_s.size > 0
	# elimino la variable de sesion
	session['redirect_after_clientinformation_update'] = nil
	# redirecciono
	redirect_adapted_to_nginx "/#{redirect_after_update.to_s}"
else
	redirect_adapted_to_nginx '/settings/clientinformation?msg=Information%20Updated.'
end
%>
<!-- ---------------------------------------- -->
