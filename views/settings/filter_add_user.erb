<%
  cid = params[:cid]
  username = params[:username]
  email = params[:email]
  linkedin_url = params[:linkedin_url]
  gtc = params[:gtc]
  parsed = nil

  session['member.users.username'] = username
  session['member.users.email'] = email

  nTries = 0
  bSuccess = false
  sError = ""

  linkedin_url_pattern = /((https?:\/\/)?(www\.)?linkedin\.com\/in\/)(([-A-Za-z0-9](\/?))+$)/

  if username.to_s.size == 0
	# libero recursos
	DB.disconnect
	GC.start
	msg = 'Username is Required.'
    redirect "/settings/users?errdesc=#{CGI.escape(msg)}"  	
  end
  
  if email.to_s.size == 0
	# libero recursos
	DB.disconnect
	GC.start
	msg = 'Email is Required.'
    redirect "/settings/users?errdesc=#{CGI.escape(msg)}"  	
  end

  if !email.email?
	# libero recursos
	DB.disconnect
	GC.start
	msg = 'Wrong email format. <b>Note:</b> You must write one, and only one, valid email address.'
    redirect "/settings/users?errdesc=#{CGI.escape(msg)}"  	
  end

  if (bSuccess==false)
	# libero recursos
	DB.disconnect
	GC.start
    redirect "/settings/users?errdesc=Failed+to+signup"
  end

  if (parsed['status'] != "success")
	# libero recursos
	DB.disconnect
	GC.start
    redirect "/settings/users?errdesc=Signup+Error+#{CGI.escape(': ' + parsed['status'])}"  	
  end

  # libero recursos
  DB.disconnect
  GC.start

  # limpio las variables de sesion, para que el fomulario quede en blanco
  session['member.users.username'] = nil
  session['member.users.email'] = nil


  # redireccionar al dashboard
  redirect '/settings/users?msgdesc=Account%20Created.'
%>
<!-- ---------------------------------------- -->
