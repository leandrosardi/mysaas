<% 
# map params key-values to session key-values 
params_to_session

# map some params who are specific for for the filter
redirect_on_success = session['redirect_on_success']

# setup default values
redirect_on_success = "/dashboard" if redirect_on_success.to_s.size == 0

# login
begin
	# guardar el ID de intento de l en una variable de sesion
	@login = BlackStack::Core::User.login(params)
	session['login.id'] = @login.id
rescue => e
	# libero recursos
	DB.disconnect
	GC.start
	# redirect
	redirect "/login?err="+ CGI::escape(e.message)
end

# blanquo la variable de sesion de redirect
session['redirect_on_success'] = nil

# redirect
redirect redirect_on_success
%>